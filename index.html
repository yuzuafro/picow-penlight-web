<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ペンライトコントローラー</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="container">
        <header>
            <h1>🎭 ペンライトコントローラー</h1>
            <p>Web Bluetooth APIでペンライトを制御</p>
        </header>

        <main>
            <!-- 接続状態 -->
            <section class="connection-section">
                <div class="status-summary">
                    <span class="device-count">接続済み: <strong id="connectedCount">0</strong>台</span>
                </div>
                <button id="connectBtn" class="btn btn-primary">ペンライトを追加</button>
            </section>

            <!-- 接続済みデバイス一覧 -->
            <section class="devices-section" id="devicesSection" style="display: none;">
                <h2>接続済みデバイス</h2>
                <div id="devicesList" class="devices-list"></div>
            </section>

            <!-- コントロール -->
            <section class="control-section" id="controlSection" style="display: none;">
                <!-- 制御対象選択 -->
                <div class="target-selection">
                    <h2>制御対象</h2>
                    <div class="target-buttons">
                        <button id="targetAllBtn" class="btn btn-target active" data-target="all">全デバイス</button>
                        <button id="targetGroupBtn" class="btn btn-target" data-target="group">グループ</button>
                        <button id="targetIndividualBtn" class="btn btn-target" data-target="individual">個別</button>
                    </div>

                    <!-- グループ選択 -->
                    <div id="groupSelection" class="selection-panel" style="display: none;">
                        <label>グループを選択:</label>
                        <div class="group-buttons" id="groupButtons">
                            <button class="btn btn-group" data-group="A">グループA</button>
                            <button class="btn btn-group" data-group="B">グループB</button>
                            <button class="btn btn-group" data-group="C">グループC</button>
                        </div>
                    </div>

                    <!-- 個別デバイス選択 -->
                    <div id="individualSelection" class="selection-panel" style="display: none;">
                        <label>デバイスを選択:</label>
                        <div class="individual-buttons" id="individualButtons"></div>
                    </div>
                </div>

                <!-- モード選択 -->
                <div class="mode-selection">
                    <h2>制御モード</h2>
                    <div class="mode-buttons">
                        <button id="colorModeBtn" class="btn btn-mode active">色選択モード</button>
                        <button id="autoModeBtn" class="btn btn-mode">自動制御モード</button>
                    </div>
                </div>

                <!-- 色選択モード -->
                <div class="color-mode" id="colorMode">
                    <h3>色を選択</h3>

                    <!-- カラープレビュー（大きく表示） -->
                    <div class="color-preview-main" id="colorPreview"></div>
                    <div class="color-value-display">
                        <span id="colorValue">#ff0000</span>
                    </div>

                    <!-- 2Dカラーピッカー -->
                    <div class="custom-color-picker">
                        <!-- 色相スライダー -->
                        <div class="slider-group">
                            <label for="hueSlider">
                                <span class="slider-label">🌈 色相</span>
                                <span class="slider-value" id="hueValue">0°</span>
                            </label>
                            <input type="range" id="hueSlider" min="0" max="360" value="0" class="color-slider hue-slider">
                        </div>

                        <!-- 2D カラーピッカー（彩度 × 明度） -->
                        <div class="color-picker-2d-container">
                            <label class="slider-label">💧 彩度 × ☀️ 明度</label>
                            <canvas id="colorPicker2D" width="280" height="200"></canvas>
                            <div class="color-picker-cursor" id="colorPickerCursor"></div>
                        </div>

                        <!-- 彩度・明度の値表示 -->
                        <div class="color-values-display">
                            <span class="color-detail">
                                <span class="value-label">彩度:</span>
                                <span class="value-number" id="saturationValue">100%</span>
                            </span>
                            <span class="color-detail">
                                <span class="value-label">明度:</span>
                                <span class="value-number" id="lightnessValue">50%</span>
                            </span>
                        </div>
                    </div>

                    <!-- プリセット色 -->
                    <div class="preset-colors">
                        <h4>よく使う色</h4>
                        <div class="preset-grid">
                            <button class="preset-color" data-color="#ff0000" style="background-color: #ff0000;" title="赤"></button>
                            <button class="preset-color" data-color="#ffa500" style="background-color: #ffa500;" title="オレンジ"></button>
                            <button class="preset-color" data-color="#ffff00" style="background-color: #ffff00;" title="黄色"></button>
                            <button class="preset-color" data-color="#00ff00" style="background-color: #00ff00;" title="緑"></button>
                            <button class="preset-color" data-color="#0000ff" style="background-color: #0000ff;" title="青"></button>
                            <button class="preset-color" data-color="#8000ff" style="background-color: #8000ff;" title="紫"></button>
                            <button class="preset-color" data-color="#ff00ff" style="background-color: #ff00ff;" title="マゼンタ"></button>
                            <button class="preset-color" data-color="#00ffff" style="background-color: #00ffff;" title="シアン"></button>
                            <button class="preset-color" data-color="#ffffff" style="background-color: #ffffff;" title="白"></button>
                            <button class="preset-color" data-color="#000000" style="background-color: #000000;" title="黒"></button>
                        </div>
                    </div>

                    <p style="text-align: center; color: #718096; font-size: 0.9rem; margin-top: 15px;">
                        💡 スライダーを動かすと自動的に反映されます
                    </p>
                </div>

                <!-- 自動制御モード -->
                <div class="auto-mode" id="autoMode" style="display: none;">
                    <h3>自動制御パターン</h3>
                    <div class="pattern-selection">
                        <div class="pattern-option">
                            <input type="radio" id="pattern1" name="pattern" value="1" checked>
                            <label for="pattern1">
                                <span class="pattern-name">パターン1: 順次変化</span>
                                <span class="pattern-desc">赤 → 橙 → 黄 → 緑 → 青 → 紫 → ピンク</span>
                            </label>
                        </div>
                        <div class="pattern-option">
                            <input type="radio" id="pattern2" name="pattern" value="2">
                            <label for="pattern2">
                                <span class="pattern-name">パターン2: 点滅</span>
                                <span class="pattern-desc">各色で点滅しながら変化</span>
                            </label>
                        </div>
                        <div class="pattern-option">
                            <input type="radio" id="pattern3" name="pattern" value="3">
                            <label for="pattern3">
                                <span class="pattern-name">パターン3: 高速変化</span>
                                <span class="pattern-desc">高速で色を切り替え</span>
                            </label>
                        </div>
                    </div>
                    <div class="auto-controls">
                        <button id="startAutoBtn" class="btn btn-success">自動制御開始</button>
                        <button id="stopAutoBtn" class="btn btn-danger" style="display: none;">自動制御停止</button>
                    </div>
                </div>

                <!-- 共通コントロール -->
                <div class="common-controls">
                    <button id="clearBtn" class="btn btn-warning">全消灯</button>
                </div>
            </section>
        </main>

        <footer>
            <div class="info">
                <p>💡 Raspberry Pi Pico W + Web Bluetooth API</p>
                <p><small>※ このアプリはHTTPS環境でのみ動作します</small></p>
            </div>
        </footer>
    </div>

    <script src="script_multi.js"></script>
</body>
</html>